server {
  server_name     <%= @servername.map { |name| name }.join(" ")%>;
  access_log /var/log/nginx/access-<%= @name%>-.log;
  error_log /var/log/nginx/error-<%= @name%>-.log;
  <% @serveroptions.sort.each do |opt,val| %>
  <%= opt %> <% val %>;
  <% end %>


#### Enable to redirect all Traffic to SSL
  if ($http_host = "www.runtastic.com") {
      rewrite ^/(.*)$ https://www.runtastic.com/$1;
  }

  if ($http_host = "runtastic.com") {
      rewrite ^/(.*)$ https://www.runtastic.com/$1;
  }

#+++++++++++++++
#++ Redirects ++
#+++++++++++++++

  if ($http_host = "maps.runtastic.com") {
      rewrite ^/(.*)$ http://www.runtastic.com/$1;
  }

  <% @locations.sort.each do |loc| %>
  location <%= loc['base'] %> {
  <%   loc['proxyoptions'].sort.each do |proxyoption,proxyoptionval| %>
  <%= proxyoption %> <% proxyoptionval %>;
  <%   end %>
  }
  <% end %>


  location ^~ /shop/ {
    rewrite ^ https://www.runtastic.com$request_uri? permanent;
  }

  location / {
    proxy_pass <%= @default_proxy_path %>;
    proxy_set_header Host $host;
    proxy_set_header x-forwarded-for $remote_addr;
  }
}
